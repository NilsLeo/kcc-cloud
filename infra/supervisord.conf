[supervisord]
nodaemon=true
user=root

[program:redis]
command=/usr/bin/redis-server --bind 127.0.0.1 --appendonly no
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:backend]
directory=/opt/backend
command=/usr/local/bin/gunicorn -c /opt/backend/gunicorn_config.py -k eventlet -w 1 -b 0.0.0.0:8060 wsgi:app
environment=PYTHONUNBUFFERED="1",DATABASE_URL="%(ENV_DATABASE_URL)s",STORAGE_PATH="%(ENV_STORAGE_PATH)s",CELERY_BROKER_URL="%(ENV_CELERY_BROKER_URL)s",TZ="%(ENV_TZ)s",ALLOWED_ORIGINS="*",MAX_UPLOAD_SIZE="%(ENV_MAX_UPLOAD_SIZE)s"
autostart=true
autorestart=true
user=appuser
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:celery]
directory=/opt/backend
command=/usr/local/bin/celery -A celery_config.celery_app worker --loglevel=info -P prefork -c %(ENV_CELERY_WORKERS)s -Q conversion -E
environment=PYTHONUNBUFFERED="1",DATABASE_URL="%(ENV_DATABASE_URL)s",STORAGE_PATH="%(ENV_STORAGE_PATH)s",CELERY_BROKER_URL="%(ENV_CELERY_BROKER_URL)s",TZ="%(ENV_TZ)s"
autostart=true
autorestart=true
user=appuser
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:next]
directory=/opt/frontend
command=/usr/local/bin/node server.js
environment=NODE_ENV="production",PORT="3000",HOSTNAME="0.0.0.0"
autostart=true
autorestart=true
user=appuser
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:nginx]
command=/usr/sbin/nginx -g 'daemon off;'
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
